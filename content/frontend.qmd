---
title: Frontend
---

The display and hosting of the radar fields has received comparatively little attention to the backend setup, but I wanted to separate it out in the documentation as I spend more time on it.

## The Details

### HRAP Grid

The most complicated part about getting the mapping correct is getting your grid straightened out. GRIB1 files contain 1121 x 881 (confirm this number) rows in a single column.  The 1121 is N(x) and the 881 is N(y).  Stuart Foote gave me a perl script circa 2013 that mapped the intersections of the grid cells.  I wrote a script to solve for the center of every bin.  One of the problems with making this into a shapefile is that the HRAP cell size changes with Latitude.  All of the answers lie in: "Coordinate Transformations for Using NEXRAD data in GIS-based Hydrologic Modeling' by Reed and Maidment (1999).  I may have read this journal article more than any other piece of paper.  I need to put my shapefile of the hrap grid on a github repo somewhere. I have .csv for state of Texas that associates lat-lon with HRAP Grid ID.  My shapefile holds HRAP Grid ID and Stg4 dumps center point (lan-lon) of radar bin. So, i can quickly map rainfall amount to HRAP Grid and my shapefile holds the size of the radar bin. I've got a bunch of interesting albeit dated literature on this topic.   

The GRIB2 file prints a lat/lon with every row.  The centerpoints of the GRIB1 and GRIB2 radar bins appear to me to be about 50m off of each other.  Lin (personal communication) at NCEP, indicated that they used a slightly different earth radius in GRIB2.  Kris Landers (personal communcation) at WGRFC didn't know anything about the bins not aligning.  I dropped it because the spatial difference was so small.  

The next time I work in a new geographic location I will document handling of the grid better. 

### Web display

I originally built a small shiny app that communicated with the S3 bucket and plotted a radar map.  I hosted it on Posit Connect Cloud.  Posit.Connect.Cloud is nice for a few reasons 1). you can stand up a website, quarto build, or shiny app in a few minutes 2). It publishes directly from your github repository so you can develop in the same place you publish, and 3). You can add secrets to inject passwords at runtime - so you can interact with you AWS environment with very little pain.

The PCC website doesn't allow for cron jobs to rebuild your website, but it republishes everytime there is a commit to the github repo hosting the page.  This is fine when your developing, but causes issue if you want regular republishing.  To work around this, my PCC website published daily by an 'empty' commit on a cron job via Github Actions.  PCC doesn't have the ability to schedule cron jobs so my workaround was to do a dummy commit with GA so that it publishes daily.  

This setup worked but was too hacky plus the spin up of the website was really slow.  PCC had to go to AWS, make queries on the parquet, retrieve the data, then plot and bring to viewport.

My workaround that appears more stable and much faster is to host the .png files I want to display in a dedicated public S3 bucket ( stg4-edwards-latest) that overwrites the latest daily file everytime it's published in the container sequence. The website is still Quarto doc hosted through Posit.Connect.Cloud, but the frontend couldn't be simpler - it just links to the stg4-edwards-latest bucket.  This way AWS does all the updating, the app is simple a pass through that adds a tabset and displays a url. It seems much faster. Yaml file and one of the tabset .qmd's pasted below.  I control how the link is cached during the write step to the S3 bucket in the map and hyetograph containers.


```{r}
#| eval: false
#| echo: true

project:
  type: website

website:
  title: "Stage4 EAA NEXRAD"
  navbar:
    left:
      - text: "24-Hour"
        href: recent-24.qmd
      - text: "YTD"
        href: year-to-date.qmd
      - text: "Hyetograph"
        href: hyet.qmd

format:
  html:
    page-layout: full
    css: [styles.css, styles-override.css]
    toc: false


```

and each tab just links to the S3 bucket (hyetograph tab):

```{r}
#| eval: false
#| echo: true

---
format: html
---


![](https://stg4-edwards-latest.s3.us-east-2.amazonaws.com/latest_hyet.png){.map-full}
```







